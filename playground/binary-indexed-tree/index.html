<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Binary indexed tree</title>
</head>
<body>
    <h1>See Chrome Devtools!</h1>
    <a href="https://zh.wikipedia.org/wiki/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84">Wiki</a>
    <a href="https://blog.csdn.net/Yaokai_AssultMaster/article/details/79492190">CSDN</a>
</body>

<script>
    const arr = [undefined, 1, 7, 3, 0, 5, 8, 3, 2, 6, 2, 1, 1, 4, 5];
    const binary = [];
    const count1 = [];
    const tree = [0];

    for (let i = 0, l = arr.length; i < l; ++i) {
        binary[i] = i.toString(2);
        count1[i] = countI(binary[i]);
    }

    for (let i = 1, l = arr.length; i < l; ++i) {
        if (count1[i] === count1[i - 1]) {
            tree[i] = tree[i - 1] + arr[i];
        } else if (count1[i] > count1[i - 1]) {
            tree[i] = arr[i];
        } else if (count1[i] < count1[i - 1]) {
            let indexLast = i - 1;
            let binaryLast = binary[indexLast];
            const countThis = count1[i];
            tree[i] = arr[i];

            while (count1[indexLast] >= countThis) {
                tree[i] += tree[indexLast];
                indexLast = indexLast - (indexLast & -indexLast);
                binaryLast = binary[indexLast];
            }
        }
    }

    console.log(tree);

    function countI(str) {
        let count = 0;
        for (let i = 0, l = str.length; i < l; ++i) {
            if ('1' === str[i]) {
                ++count;
            }
        }
        return count;
    }
</script>
</html>
